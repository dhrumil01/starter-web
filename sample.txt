code from master branch
some merge toold changes
some changes here and there



